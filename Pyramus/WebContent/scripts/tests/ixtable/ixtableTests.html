<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>JsUnit Utility Tests</title>
  <link rel="stylesheet" type="text/css" href="../css/jsunit/jsUnitStyle.css">
  <script language="JavaScript" type="text/javascript" src="../jsunit/app/jsUnitCore.js"></script>
  
  <script language="JavaScript" type="text/javascript" src="../../prototype/prototype.js"></script>
  <script language="JavaScript" type="text/javascript" src="../../scriptaculous/src/scriptaculous.js"></script>
  <script language="JavaScript" type="text/javascript" src="../../fnievents/fnievents.js"></script>
  <script language="JavaScript" type="text/javascript" src="../../ixtable/ixtable.js"></script>
  
  <script language="JavaScript" type="text/javascript">
    
    var TABLEID = "testTable";  
    var COL1TEXT = "Header 1";
    var COL1LEFT = 0;
    var COL1WIDTH = 100;
    var COL1DATATYPE = 'text';
    var COL2TEXT = "Header 2";
    var COL2LEFT = 108;
    var COL2RIGHT = 0;
    var COL2DATATYPE = 'number';

    function setUp() {
      var testTable = new IxTable($('tableContainer'), {
        id: TABLEID,
        removeRowBtns : true,
        columns:[{
          header : COL1TEXT,
          left : COL1LEFT,
          width : COL1WIDTH,
          dataType: COL1DATATYPE
        }, {
          header : COL2TEXT,
          left : COL2LEFT,
          right : COL2RIGHT,
          dataType: COL2DATATYPE
        }]
      });
    } 

    function testGetIxTableById() {
      assertNotNull(getIxTableById(TABLEID));
      assertNotUndefined(getIxTableById(TABLEID));
      assertUndefined(getIxTableById('foo'));
    }
    
    function testAddRow() {
      var table = getIxTableById(TABLEID);
      var rowNumber = table.addRow(['one', '1']);
      assertEquals(1, table.getRowCount());
      assertEquals('one', table.getCellValue(rowNumber, 0));
      assertEquals('1', table.getCellValue(rowNumber, 1));
      table.deleteAllRows();
      assertEquals(0, table.getRowCount());
    }

    function testGetCellEditor() {
      var table = getIxTableById(TABLEID);
      var rowNumber = table.addRow(['one', '1']);
      assertEquals(1, table.getRowCount());
      assertNotNull(table.getCellEditor(rowNumber, 0));
      assertEquals('text', table.getCellEditor(rowNumber, 0)._dataType);
      table.deleteAllRows();
      assertEquals(0, table.getRowCount());
    }
    function testSetCellValue() {
      var table = getIxTableById(TABLEID);
      var rowNumber = table.addRow(['one', '1']);
      assertEquals(1, table.getRowCount());
      table.setCellValue(rowNumber, 0, 'muutettu');
      assertEquals('muutettu', table.getCellValue(rowNumber, 0));
      table.deleteAllRows();
    }

    function testDisableCellEditor() {
      var table = getIxTableById(TABLEID);
      var rowNumber = table.addRow(['one', '1']);
      assertEquals(1, table.getRowCount());

      assertFalse(table.getCellEditor(rowNumber, 0).disabled);
      table.disableCellEditor(rowNumber, 0);
      assertTrue(table.getCellEditor(rowNumber, 0).disabled);
      table.enableCellEditor(rowNumber, 0);
      assertFalse(table.getCellEditor(rowNumber, 0).disabled);
      table.deleteAllRows();
    }

    function testGetRowCount() {

      var table = getIxTableById(TABLEID);
      table.addRow(['1', 'one']);
      table.addRow(['2', 'two']);
      table.addRow(['3', 'three']);
      table.addRow(['4', 'four']);

      assertEquals(4, table.getRowCount());

      assertEquals('1', table.getCellValue(0, 0));
      assertEquals('2', table.getCellValue(1, 0));
      assertEquals('3', table.getCellValue(2, 0));
      assertEquals('4', table.getCellValue(3, 0));
      
      assertEquals('one', table.getCellValue(0, 1));
      assertEquals('two', table.getCellValue(1, 1));
      assertEquals('three', table.getCellValue(2, 1));
      assertEquals('four', table.getCellValue(3, 1));
      
      table.deleteRow(2);
      assertEquals(3, table.getRowCount());

      assertEquals('1', table.getCellValue(0, 0));
      assertEquals('2', table.getCellValue(1, 0));
      assertEquals('4', table.getCellValue(2, 0));

      assertEquals('one', table.getCellValue(0, 1));
      assertEquals('two', table.getCellValue(1, 1));
      assertEquals('four', table.getCellValue(2, 1));
      
      table.deleteRow(0);
      assertEquals(2, table.getRowCount());

      assertEquals('2', table.getCellValue(0, 0));
      assertEquals('4', table.getCellValue(1, 0));

      assertEquals('two', table.getCellValue(0, 1));
      assertEquals('four', table.getCellValue(1, 1));
      
      table.deleteRow(1);
      assertEquals(1, table.getRowCount());

      assertEquals('2', table.getCellValue(0, 0));
      assertEquals('two', table.getCellValue(0, 1));

      table.deleteRow(0);
      
      assertEquals(0, table.getRowCount());
    }

    function testSubmit() {
      var table = getIxTableById(TABLEID);
      table.addRow(['1', 'one']);
      table.addRow(['2', 'two']);
      table.addRow(['3', 'three']);
      table.addRow(['4', 'four']);

      var formData = $('testForm').serialize(true);

      assertEquals('1', formData[TABLEID + '.0.0']);
      assertEquals('2', formData[TABLEID + '.1.0']);
      assertEquals('3', formData[TABLEID + '.2.0']);
      assertEquals('4', formData[TABLEID + '.3.0']);
      
      assertEquals('one', formData[TABLEID + '.0.1']);
      assertEquals('two', formData[TABLEID + '.1.1']);
      assertEquals('three', formData[TABLEID + '.2.1']);
      assertEquals('four', formData[TABLEID + '.3.1']);

      table.deleteRow(0);
      formData = $('testForm').serialize(true);
      
      assertEquals('2', formData[TABLEID + '.0.0']);
      assertEquals('3', formData[TABLEID + '.1.0']);
      assertEquals('4', formData[TABLEID + '.2.0']);
      
      assertEquals('two', formData[TABLEID + '.0.1']);
      assertEquals('three', formData[TABLEID + '.1.1']);
      assertEquals('four', formData[TABLEID + '.2.1']);

      table.deleteRow(1);
      formData = $('testForm').serialize(true);
      
      assertEquals('2', formData[TABLEID + '.0.0']);
      assertEquals('4', formData[TABLEID + '.1.0']);
      
      assertEquals('two', formData[TABLEID + '.0.1']);
      assertEquals('four', formData[TABLEID + '.1.1']);

      table.deleteRow(1);
      formData = $('testForm').serialize(true);
      
      assertEquals('2', formData[TABLEID + '.0.0']);
      
      assertEquals('two', formData[TABLEID + '.0.1']);
    } 
  </script>
</head>

<body>
  <h1>IxTable class tests</h1>
  <form id="testForm">
    <div id="tableContainer"></div>
  </form>
</body>
</html>
